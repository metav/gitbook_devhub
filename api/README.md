# API Reference

Welcome to the OORT Datahub API documentation. This documentation covers the communication protocol between OORT Datahub and third-party plugins.

## Authentication

Security is paramount. All requests between Datahub and plugins must be authenticated using HMAC-SHA256 signatures.

### Headers
Every request must include the following headers:

| Header | Description |
| :--- | :--- |
| `X-Signature` | The HMAC-SHA256 signature of the request. |
| `X-Timestamp` | Current timestamp (seconds since epoch). |
| `X-Nonce` | A unique random string/number to prevent replay attacks. |
| `X-Service-Id` | The unique ID of the service/plugin. |

### Signature Generation
The signature is generated by signing a concatenated string of the request details:
`timestamp + nonce + body_json_string`

**Python Example:**

```python
import hashlib
import hmac
import json
import time
import requests

service_id = "your_service_id"
api_key = "your_secret_key"

def call_api(url, data):
    timestamp = str(int(time.time()))
    nonce = str(int(time.time() * 1000000))  # Simple nonce
    
    # Sort keys for consistent JSON string
    body = json.dumps(data, sort_keys=True, separators=(',', ':'))
    
    # Create message to sign
    message = f"{timestamp}{nonce}{body}"
    
    # Generate signature
    signature = hmac.new(
        api_key.encode('utf-8'),
        message.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    headers = {
        "Content-Type": "application/json",
        "X-Service-Id": service_id,
        "X-Signature": signature,
        "X-Timestamp": timestamp,
        "X-Nonce": nonce
    }
    
    response = requests.post(url, headers=headers, data=body)
    return response.json()
```
